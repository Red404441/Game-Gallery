<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Gallery Link Generator</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
/* ‚îÄ‚îÄ Tokens ‚îÄ‚îÄ */
:root{
  --sky-top:#6ec6f5;--sky-mid:#b8e0f7;--sky-low:#dff2fd;
  --glass:rgba(255,255,255,0.68);--glass-border:rgba(255,255,255,0.80);
  --glass-shadow:rgba(0,40,100,0.10);
  --accent:#0e7fcc;--accent-glow:rgba(14,127,204,0.22);--accent-2:#46c4e3;
  --success:#0a9e6e;--success-glow:rgba(10,158,110,0.18);
  --danger:#c0392b;--danger-glow:rgba(192,57,43,0.15);
  --warn:#d4870a;
  --text:#042a3c;--text-mid:#185470;--text-soft:#3a7a99;
  --r-lg:18px;--r-md:12px;--r-sm:8px;
  --fd:'Unbounded',sans-serif;--fb:'DM Sans',sans-serif;--fm:'DM Mono',monospace;
  --ease:.26s cubic-bezier(.2,.9,.3,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
html{-webkit-font-smoothing:antialiased;}
body{
  min-height:100dvh;font-family:var(--fb);color:var(--text);
  background:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"),
    linear-gradient(170deg,var(--sky-top) 0%,var(--sky-mid) 45%,var(--sky-low) 80%,#f0faff 100%);
  background-attachment:fixed;
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  padding:28px 16px 72px;
}
body::before,body::after{content:'';position:fixed;border-radius:50%;pointer-events:none;z-index:0;}
body::before{width:560px;height:560px;background:radial-gradient(circle,rgba(110,198,245,.26),transparent 65%);top:-140px;right:-140px;}
body::after{width:400px;height:400px;background:radial-gradient(circle,rgba(70,196,227,.16),transparent 65%);bottom:-100px;left:-100px;}

/* ‚îÄ‚îÄ Keyboard shortcut helper ‚îÄ‚îÄ */
kbd{display:inline-flex;align-items:center;background:rgba(0,80,140,.07);border:1px solid rgba(0,80,140,.15);border-radius:4px;padding:1px 5px;font-family:var(--fm);font-size:10px;color:var(--text-soft);line-height:1.5;vertical-align:middle;}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
.card{
  position:relative;z-index:1;width:min(580px,100%);
  background:var(--glass);border:1px solid var(--glass-border);
  border-radius:var(--r-lg);padding:28px 26px 26px;
  box-shadow:0 24px 60px var(--glass-shadow),inset 0 0 0 1px rgba(255,255,255,.5);
  backdrop-filter:blur(18px) saturate(140%);-webkit-backdrop-filter:blur(18px) saturate(140%);
  animation:cardIn .5s cubic-bezier(.2,.9,.3,1) both;
  display:flex;flex-direction:column;gap:0;
}
@keyframes cardIn{from{opacity:0;transform:translateY(20px) scale(.98);}to{opacity:1;transform:none;}}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.hdr{display:flex;align-items:center;gap:13px;margin-bottom:22px;}
.hdr-logo{width:44px;height:44px;flex-shrink:0;border-radius:var(--r-md);background:linear-gradient(145deg,#d4f0ff,#aadaf5);box-shadow:0 4px 14px rgba(0,80,160,.12),inset 0 1px 0 rgba(255,255,255,.7);display:flex;align-items:center;justify-content:center;}
.hdr-logo svg{width:22px;height:22px;}
.hdr-text h1{font-family:var(--fd);font-size:16px;font-weight:900;color:var(--text);letter-spacing:-.4px;}
.hdr-text p{font-size:12px;color:var(--text-soft);margin-top:3px;}
.hdr-text p kbd{font-size:9.5px;}

/* ‚îÄ‚îÄ Section heading ‚îÄ‚îÄ */
.sec-title{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--text-soft);margin-bottom:10px;display:flex;align-items:center;gap:8px;}
.sec-title::after{content:'';flex:1;height:1px;background:rgba(0,80,140,.08);}

/* ‚îÄ‚îÄ Field ‚îÄ‚îÄ */
.field{display:flex;flex-direction:column;gap:5px;}
.field-label{font-size:11.5px;font-weight:600;color:var(--text-mid);display:flex;align-items:center;gap:6px;}
.field-hint{font-size:11px;color:var(--text-soft);font-weight:400;}
.field input,.field select{
  padding:10px 12px;border-radius:var(--r-md);
  border:1.5px solid rgba(0,0,0,.07);font-size:14px;
  font-family:var(--fb);color:var(--text);
  background:rgba(255,255,255,.88);
  box-shadow:0 2px 8px rgba(0,0,0,.04),inset 0 1px 0 white;
  outline:none;transition:border-color .18s,box-shadow .18s;width:100%;
}
.field input:focus,.field select:focus{border-color:rgba(14,127,204,.4);box-shadow:0 0 0 4px var(--accent-glow),0 2px 8px rgba(0,0,0,.04);}
.field input::placeholder{color:#a8bfcc;}
.field input.ok{border-color:rgba(10,158,110,.4);box-shadow:0 0 0 3px var(--success-glow);}
.field input.bad{border-color:rgba(192,57,43,.42);box-shadow:0 0 0 3px var(--danger-glow);}

/* URL field wrapper with inline paste + detect buttons */
.url-wrap{position:relative;}
.url-wrap input{padding-right:138px;}
.url-btns{position:absolute;right:6px;top:50%;transform:translateY(-50%);display:flex;gap:4px;}
.url-btn{height:28px;padding:0 10px;border-radius:6px;border:1px solid rgba(0,80,140,.14);background:rgba(255,255,255,.8);font-size:11.5px;font-weight:600;color:var(--text-mid);cursor:pointer;transition:background .15s,transform .1s;white-space:nowrap;display:flex;align-items:center;gap:4px;}
.url-btn:hover{background:rgba(255,255,255,1);transform:translateY(-1px);}
.url-btn:active{transform:scale(.97);}

/* ‚îÄ‚îÄ Favicon bar ‚îÄ‚îÄ */
.fav-bar{display:none;align-items:center;gap:9px;background:rgba(255,255,255,.55);border:1px solid rgba(0,80,140,.10);border-radius:var(--r-sm);padding:7px 11px;font-size:12px;color:var(--text-mid);}
.fav-bar.on{display:flex;}
.fav-bar img{width:18px;height:18px;border-radius:3px;object-fit:contain;}
.fav-ok{font-size:11px;color:var(--success);font-weight:700;margin-left:auto;}

/* ‚îÄ‚îÄ Two-column ‚îÄ‚îÄ */
.two{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
@media(max-width:460px){.two{grid-template-columns:1fr;}}

/* ‚îÄ‚îÄ Toggle ‚îÄ‚îÄ */
.tog-row{display:flex;align-items:center;gap:9px;padding-top:2px;}
.tog{position:relative;width:34px;height:19px;flex-shrink:0;}
.tog input{opacity:0;width:0;height:0;position:absolute;}
.tog-track{position:absolute;inset:0;border-radius:10px;background:rgba(0,80,140,.15);cursor:pointer;transition:background .2s;}
.tog input:checked+.tog-track{background:var(--accent);}
.tog-thumb{position:absolute;top:2.5px;left:2.5px;width:14px;height:14px;border-radius:50%;background:white;box-shadow:0 1px 3px rgba(0,0,0,.2);transition:transform .2s;pointer-events:none;}
.tog input:checked~.tog-thumb{transform:translateX(15px);}
.tog-lbl{font-size:12px;color:var(--text-mid);font-weight:500;cursor:pointer;user-select:none;}

/* custom cat + date hidden by default */
#customCatWrap,#dateRow{display:none;}
#customCatWrap.on,#dateRow.on{display:grid;}

/* ‚îÄ‚îÄ Divider ‚îÄ‚îÄ */
.div{height:1px;background:linear-gradient(90deg,transparent,rgba(0,80,140,.09),transparent);margin:18px 0;}

/* ‚îÄ‚îÄ Output code block ‚îÄ‚îÄ */
.out-block{
  position:relative;
  background:rgba(3,22,40,.90);border-radius:var(--r-md);padding:14px 44px 14px 15px;
  border:1px solid rgba(255,255,255,.06);
  box-shadow:0 8px 22px rgba(0,0,0,.18),inset 0 1px 0 rgba(255,255,255,.04);
  font-family:var(--fm);font-size:13px;line-height:1.65;
  color:#c8e8f8;word-break:break-all;min-height:46px;
  transition:box-shadow .2s;
}
.out-block.flash{box-shadow:0 0 0 3px var(--success-glow),0 8px 22px rgba(0,0,0,.18);}
.out-block .ph{color:rgba(200,232,248,.28);}
/* syntax */
.sb{color:#7ec8e3;}.sk{color:#80cbc4;}.ss{color:#c3e88d;}.sc{color:#ffcb6b;}.sd{color:#f78c6c;}.sm{color:#7ec8e3;}
/* copy btn */
.cp{position:absolute;top:8px;right:8px;width:28px;height:28px;border-radius:var(--r-sm);border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.07);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background var(--ease),transform var(--ease);}
.cp:hover{background:rgba(255,255,255,.17);transform:scale(1.08);}
.cp svg{width:13px;height:13px;pointer-events:none;}
.cp .ck{display:none;}.cp.copied .ic{display:none;}.cp.copied .ck{display:block;}

/* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
.btn{padding:10px 16px;border-radius:var(--r-md);border:0;cursor:pointer;font-family:var(--fb);font-size:13px;font-weight:600;transition:transform var(--ease),box-shadow var(--ease),background var(--ease);white-space:nowrap;}
.btn:active{transform:scale(.97);}
.btn:disabled{opacity:.38;cursor:not-allowed;transform:none!important;box-shadow:none!important;}
.btn-p{background:linear-gradient(145deg,var(--accent),#0a6ab5);color:white;box-shadow:0 6px 18px rgba(14,127,204,.28);font-family:var(--fd);font-size:10.5px;font-weight:700;letter-spacing:.4px;}
.btn-p:hover:not(:disabled){box-shadow:0 10px 26px rgba(14,127,204,.36);transform:translateY(-1px);}
.btn-g{background:rgba(255,255,255,.62);border:1px solid rgba(0,80,140,.13);color:var(--text-mid);}
.btn-g:hover{background:rgba(255,255,255,.9);}
.btn-suc{background:linear-gradient(145deg,#0a9e6e,#077a54);color:white;box-shadow:0 6px 18px rgba(10,158,110,.26);}
.btn-suc:hover{box-shadow:0 10px 26px rgba(10,158,110,.36);transform:translateY(-1px);}
.btn-danger{background:rgba(192,57,43,.12);border:1px solid rgba(192,57,43,.2);color:var(--danger);}
.btn-danger:hover{background:rgba(192,57,43,.22);}

/* ‚îÄ‚îÄ Action row ‚îÄ‚îÄ */
.act-row{display:flex;gap:8px;margin-top:12px;}
.act-row .btn-p{flex:1;}

/* ‚îÄ‚îÄ Queue ‚îÄ‚îÄ */
.q-wrap{display:none;}
.q-wrap.on{display:flex;flex-direction:column;gap:0;}
.q-head{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;border-bottom:1px solid rgba(255,255,255,.07);font-size:11.5px;color:rgba(200,232,248,.5);}
.q-head-btns{display:flex;gap:6px;}
.q-hbtn{height:24px;padding:0 10px;border-radius:6px;border:1px solid rgba(14,127,204,.2);background:rgba(14,127,204,.18);color:#7ec8e3;font-family:var(--fb);font-size:11px;font-weight:600;cursor:pointer;transition:background .15s;}
.q-hbtn:hover{background:rgba(14,127,204,.36);}
.q-hbtn.danger{background:rgba(192,57,43,.12);border-color:rgba(192,57,43,.18);color:rgba(255,100,80,.85);}
.q-hbtn.danger:hover{background:rgba(192,57,43,.30);}
.q-list{background:rgba(3,22,40,.90);border-radius:var(--r-md);border:1px solid rgba(255,255,255,.06);box-shadow:0 8px 22px rgba(0,0,0,.18);max-height:220px;overflow-y:auto;font-family:var(--fm);font-size:12px;color:#c8e8f8;}
.q-list::-webkit-scrollbar{width:6px;}
.q-list::-webkit-scrollbar-thumb{background:rgba(255,255,255,.12);border-radius:6px;}
.q-item{padding:9px 38px 9px 13px;border-bottom:1px solid rgba(255,255,255,.04);position:relative;line-height:1.55;animation:itemIn .2s var(--ease) both;}
.q-item:last-child{border-bottom:0;}
@keyframes itemIn{from{opacity:0;transform:translateX(-6px);}to{opacity:1;transform:none;}}
.q-rm{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:20px;height:20px;border-radius:50%;border:0;background:rgba(192,57,43,.15);color:rgba(255,100,80,.85);font-size:14px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .14s;}
.q-rm:hover{background:rgba(192,57,43,.38);}

/* ‚îÄ‚îÄ Queue empty state ‚îÄ‚îÄ */
.q-empty{text-align:center;padding:18px 12px 10px;font-size:12.5px;color:var(--text-soft);}
.q-empty strong{color:var(--text-mid);}

/* ‚îÄ‚îÄ Bulk modal ‚îÄ‚îÄ */
.modal-bg{position:fixed;inset:0;z-index:200;background:rgba(4,12,24,.5);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;padding:20px;}
.modal-bg.on{display:flex;}
.modal{background:rgba(255,255,255,.97);border:1px solid var(--glass-border);border-radius:var(--r-lg);padding:26px 24px 22px;width:min(500px,100%);box-shadow:0 32px 64px rgba(0,20,60,.22);animation:modalIn .3s var(--ease) both;display:flex;flex-direction:column;gap:12px;}
@keyframes modalIn{from{opacity:0;transform:scale(.96);}to{opacity:1;transform:none;}}
.modal h2{font-family:var(--fd);font-size:15px;font-weight:900;color:var(--text);}
.modal p{font-size:12.5px;color:var(--text-soft);line-height:1.55;}
.modal textarea{width:100%;height:130px;padding:11px 13px;border-radius:var(--r-md);border:1.5px solid rgba(0,0,0,.08);font-family:var(--fm);font-size:12.5px;color:var(--text);background:rgba(255,255,255,.9);outline:none;resize:vertical;box-shadow:0 2px 8px rgba(0,0,0,.04);}
.modal textarea:focus{border-color:rgba(14,127,204,.4);box-shadow:0 0 0 3px var(--accent-glow);}
.modal-stat{font-size:12px;color:var(--text-soft);min-height:16px;}
.modal-acts{display:flex;gap:8px;justify-content:flex-end;}

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(14px);z-index:9999;background:rgba(255,255,255,.96);border:1px solid var(--glass-border);border-radius:var(--r-md);padding:9px 16px;box-shadow:0 12px 28px rgba(0,30,60,.14);font-size:13px;color:var(--text);display:flex;align-items:center;gap:8px;opacity:0;pointer-events:none;transition:opacity .24s,transform .24s;backdrop-filter:blur(10px);white-space:nowrap;}
.toast.on{opacity:1;transform:translateX(-50%) translateY(0);}
.toast-dot{width:7px;height:7px;border-radius:50%;background:var(--success);flex-shrink:0;}
.toast-dot.err{background:var(--danger);}
.toast-dot.info{background:var(--accent);}

/* ‚îÄ‚îÄ Badge ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;background:var(--accent);color:white;border-radius:100px;font-size:10px;font-weight:700;padding:0 5px;vertical-align:middle;margin-left:5px;}
</style>
</head>
<body>

<div class="card">

  <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ -->
  <div class="hdr">
    <div class="hdr-logo">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M8 12h2m-1-1v2" stroke="#0e7fcc" stroke-width="1.8" stroke-linecap="round"/>
        <circle cx="17" cy="12" r="1.2" fill="#0e7fcc"/>
        <circle cx="14.5" cy="12" r="1.2" fill="#46c4e3"/>
        <rect x="2" y="7" width="20" height="12" rx="3.5" stroke="#0e7fcc" stroke-width="1.7"/>
        <path d="M9 7V5.5a3 3 0 0 1 6 0V7" stroke="#0e7fcc" stroke-width="1.7" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="hdr-text">
      <h1>Gallery Link Generator</h1>
      <p>Paste a URL, hit <kbd>Enter</kbd> ‚Äî copy the output into your LINKS array.</p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 1 ¬∑ URL ‚îÄ‚îÄ -->
  <div class="sec-title">1 ¬∑ URL</div>
  <div class="field" style="margin-bottom:10px;">
    <div class="url-wrap">
      <input id="urlIn" type="url" placeholder="Paste or type a URL‚Ä¶" autocomplete="off" spellcheck="false" autofocus/>
      <div class="url-btns">
        <button class="url-btn" id="pasteBtn" title="Paste from clipboard">‚éò Paste</button>
        <button class="url-btn" id="detectBtn" title="Auto-detect name from page title (slow)" style="display:none">üîç</button>
      </div>
    </div>
  </div>

  <!-- Favicon bar -->
  <div class="fav-bar" id="favBar">
    <img id="favImg" src="" alt=""/>
    <span>Favicon found ¬∑ <strong id="favHost"></strong></span>
    <span class="fav-ok">‚úì</span>
  </div>

  <!-- ‚îÄ‚îÄ STEP 2 ¬∑ Details ‚îÄ‚îÄ -->
  <div class="sec-title" style="margin-top:14px;">2 ¬∑ Details</div>
  <div style="display:flex;flex-direction:column;gap:11px;margin-bottom:10px;">

    <div class="field">
      <label class="field-label" for="nameIn">Display Name <span class="field-hint">(auto-filled from URL)</span></label>
      <input id="nameIn" type="text" placeholder="My Awesome Game" autocomplete="off"/>
    </div>

    <div class="two">
      <div class="field">
        <label class="field-label" for="catIn">Category</label>
        <select id="catIn">
          <option value="io">.io Games</option>
          <option value="hub" selected>Hub / Portal</option>
          <option value="classic">Classic</option>
          <option value="fun">Fun / Misc</option>
          <option value="retro">Retro / OS</option>
          <option value="edu">Education</option>
          <option value="sim">Simulation</option>
          <option value="cloud">Cloud Gaming</option>
          <option value="__new__">+ New category‚Ä¶</option>
        </select>
      </div>
      <div class="field">
        <label class="field-label">Mark as newest?</label>
        <div class="tog-row">
          <label class="tog">
            <input type="checkbox" id="dateToggle"/>
            <div class="tog-track"></div>
            <div class="tog-thumb"></div>
          </label>
          <label class="tog-lbl" for="dateToggle">Add <code style="font-size:10.5px;background:rgba(0,80,140,.08);padding:1px 5px;border-radius:4px;">added</code> date</label>
        </div>
      </div>
    </div>

    <!-- New category inputs -->
    <div id="customCatWrap" class="two" style="gap:11px;">
      <div class="field">
        <label class="field-label" for="catKey">Key <span class="field-hint">(no spaces)</span></label>
        <input id="catKey" type="text" placeholder="action" spellcheck="false"/>
      </div>
      <div class="field">
        <label class="field-label" for="catLabel">UI Label</label>
        <input id="catLabel" type="text" placeholder="Action Games"/>
      </div>
    </div>

    <!-- Date input -->
    <div id="dateRow" class="two" style="gap:11px;">
      <div class="field">
        <label class="field-label" for="dateIn">Added date</label>
        <input id="dateIn" type="date"/>
      </div>
      <div></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 3 ¬∑ Output ‚îÄ‚îÄ -->
  <div class="div"></div>
  <div class="sec-title">3 ¬∑ Output</div>

  <div class="out-block" id="outBlock">
    <button class="cp" id="cpBtn" title="Copy" aria-label="Copy line">
      <svg class="ic" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" stroke="#c8e8f8" stroke-width="1.6"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="#c8e8f8" stroke-width="1.6" stroke-linecap="round"/></svg>
      <svg class="ck" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#c3e88d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
    <span id="outTxt"><span class="ph">Fill in the fields above‚Ä¶ output appears here.</span></span>
  </div>

  <!-- CAT_LABELS output (new cat only) -->
  <div id="catOutWrap" style="display:none;margin-top:11px;">
    <div class="sec-title" style="margin-bottom:8px;">Also add to <code style="font-size:10.5px;background:rgba(0,80,140,.08);padding:1px 5px;border-radius:4px;text-transform:none;letter-spacing:0;">CAT_LABELS</code></div>
    <div class="out-block" id="catOutBlock">
      <button class="cp" id="cpCatBtn" aria-label="Copy category line">
        <svg class="ic" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" stroke="#c8e8f8" stroke-width="1.6"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="#c8e8f8" stroke-width="1.6" stroke-linecap="round"/></svg>
        <svg class="ck" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#c3e88d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <span id="catOutTxt"></span>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="act-row">
    <button class="btn btn-p" id="addQBtn" disabled>+ Add to queue</button>
    <button class="btn btn-g" id="cpDirectBtn">Copy</button>
    <button class="btn btn-g" id="resetBtn" title="Clear form">‚Ü∫</button>
  </div>

  <!-- ‚îÄ‚îÄ Queue ‚îÄ‚îÄ -->
  <div class="div"></div>
  <div class="sec-title">
    Queue
    <span class="badge" id="qBadge" style="display:none">0</span>
  </div>

  <!-- Empty state -->
  <div class="q-empty" id="qEmpty">
    No items yet. Add entries above or <button class="btn btn-g" id="bulkBtnEmpty" style="padding:5px 11px;font-size:12px;margin-left:2px;">üìã Bulk import URLs</button>
  </div>

  <!-- Queue list -->
  <div class="q-wrap" id="qWrap">
    <div class="q-list" id="qList">
      <div class="q-head">
        <span id="qCount">0 items</span>
        <div class="q-head-btns">
          <button class="q-hbtn" id="cpAllBtn">Copy all</button>
          <button class="q-hbtn" id="bulkBtn">üìã Bulk import</button>
          <button class="q-hbtn danger" id="clrBtn">Clear all</button>
        </div>
      </div>
      <div id="qItems"></div>
    </div>
  </div>

  <!-- Footer -->
  <div style="margin-top:18px;text-align:center;font-size:11.5px;color:var(--text-soft);">
    For use with <a href="https://github.com/Red404441/Games-gallery-" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;">The Game Gallery ‚Üó</a>
    &nbsp;¬∑&nbsp; <kbd>Enter</kbd> to add &nbsp;¬∑&nbsp; <kbd>Esc</kbd> to reset
  </div>

</div><!-- /card -->

<!-- ‚îÄ‚îÄ Bulk import modal ‚îÄ‚îÄ -->
<div class="modal-bg" id="bulkBg">
  <div class="modal">
    <h2>üìã Bulk import URLs</h2>
    <p>Paste one URL per line. Names are auto-guessed from the domain. You can edit them after adding.</p>
    <textarea id="bulkTA" placeholder="https://slither.io/&#10;https://example.com/&#10;https://coolmathgames.com/"></textarea>
    <div class="modal-stat" id="bulkStat"></div>
    <div class="modal-acts">
      <button class="btn btn-g" id="bulkCancel">Cancel</button>
      <button class="btn btn-p" id="bulkAdd">Add to queue</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Toast ‚îÄ‚îÄ -->
<div class="toast" id="toast"><div class="toast-dot" id="tDot"></div><span id="tMsg"></span></div>

<script>
'use strict';

/* ‚îÄ‚îÄ refs ‚îÄ‚îÄ */
const $ = id => document.getElementById(id);
const urlIn     = $('urlIn');
const nameIn    = $('nameIn');
const catIn     = $('catIn');
const catKey    = $('catKey');
const catLabel  = $('catLabel');
const catWrap   = $('customCatWrap');
const dateToggle= $('dateToggle');
const dateRow   = $('dateRow');
const dateIn    = $('dateIn');
const outBlock  = $('outBlock');
const outTxt    = $('outTxt');
const cpBtn     = $('cpBtn');
const cpDirectBtn=$('cpDirectBtn');
const resetBtn  = $('resetBtn');
const catOutWrap= $('catOutWrap');
const catOutTxt = $('catOutTxt');
const cpCatBtn  = $('cpCatBtn');
const catOutBlock=$('catOutBlock');
const addQBtn   = $('addQBtn');
const qBadge    = $('qBadge');
const qEmpty    = $('qEmpty');
const qWrap     = $('qWrap');
const qList     = $('qList');
const qItems    = $('qItems');
const qCount    = $('qCount');
const cpAllBtn  = $('cpAllBtn');
const clrBtn    = $('clrBtn');
const bulkBtn   = $('bulkBtn');
const bulkBtnE  = $('bulkBtnEmpty');
const pasteBtn  = $('pasteBtn');
const favBar    = $('favBar');
const favImg    = $('favImg');
const favHost   = $('favHost');
const bulkBg    = $('bulkBg');
const bulkTA    = $('bulkTA');
const bulkStat  = $('bulkStat');
const bulkCancel= $('bulkCancel');
const bulkAdd   = $('bulkAdd');

let queue = [];
let nameTouched = false;

/* ‚îÄ‚îÄ Defaults ‚îÄ‚îÄ */
dateIn.value = new Date().toISOString().slice(0,10);

/* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
function esc(s){ return String(s).replace(/\\/g,'\\\\').replace(/"/g,'\\"'); }
function escSQ(s){ return String(s).replace(/'/g,"\\'"); }
function getCat(){ return catIn.value==='__new__' ? (catKey.value.trim().replace(/\s+/g,'').toLowerCase()||'custom') : catIn.value; }
function buildLine(n,u,c,d){ return `{name:"${esc(n)}", url:"${esc(u)}", cat:"${esc(c)}"${d?`, added:"${esc(d)}"`:''}}${','}`; }
function buildCatLine(k,l){ return `  ${k}: '${escSQ(l)}',`; }

function hl(n,u,c,d){
  let h=`<span class="sb">{</span><span class="sk">name:</span><span class="ss">"${esc(n)}"</span>, <span class="sk">url:</span><span class="ss">"${esc(u)}"</span>, <span class="sk">cat:</span><span class="sc">"${esc(c)}"</span>`;
  if(d) h+=`, <span class="sk">added:</span><span class="sd">"${esc(d)}"</span>`;
  return h+`<span class="sb">}</span><span class="sm">,</span>`;
}
function hlCat(k,l){ return `<span style="color:#80cbc4">${esc(k)}</span><span style="color:#7ec8e3">: </span><span style="color:#c3e88d">'${escSQ(l)}'</span><span style="color:#7ec8e3">,</span>`; }

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
let tTimer;
function toast(msg, type='ok'){
  $('tMsg').textContent=msg;
  $('tDot').className='toast-dot'+(type==='err'?' err':type==='info'?' info':'');
  const el=$('toast'); el.classList.add('on');
  clearTimeout(tTimer); tTimer=setTimeout(()=>el.classList.remove('on'),2400);
}

/* ‚îÄ‚îÄ Favicon ‚îÄ‚îÄ */
let favTimer;
function showFav(url){
  clearTimeout(favTimer);
  try{
    const host=new URL(url).hostname; if(!host){favBar.classList.remove('on');return;}
    favTimer=setTimeout(()=>{
      const src=`https://www.google.com/s2/favicons?domain=${host}&sz=64`;
      favImg.src=src; favHost.textContent=host.replace(/^www\./,'');
      favBar.classList.add('on');
      favImg.onerror=()=>favBar.classList.remove('on');
    },300);
  }catch{ favBar.classList.remove('on'); }
}

/* ‚îÄ‚îÄ Auto-name from URL ‚îÄ‚îÄ */
function guessName(url){
  try{ const h=new URL(url).hostname.replace(/^www\./,''); const s=h.split('.')[0]; return s.charAt(0).toUpperCase()+s.slice(1); }
  catch{ return ''; }
}

/* ‚îÄ‚îÄ URL state ‚îÄ‚îÄ */
function validateUrl(v){
  urlIn.classList.remove('ok','bad');
  if(!v) return;
  try{ new URL(v); urlIn.classList.add('ok'); }
  catch{ if(v.length>4) urlIn.classList.add('bad'); }
}

/* ‚îÄ‚îÄ Paste button ‚îÄ‚îÄ */
pasteBtn.addEventListener('click', async ()=>{
  try{
    const t=(await navigator.clipboard.readText()).trim();
    if(t.startsWith('http')){ urlIn.value=t; onUrlChange(); toast('URL pasted ‚úì','info'); }
    else toast('No URL found on clipboard','err');
  }catch{ toast('Paste manually ‚Äî clipboard blocked','err'); }
});

/* ‚îÄ‚îÄ Core URL handler ‚îÄ‚îÄ */
function onUrlChange(){
  const v=urlIn.value.trim();
  validateUrl(v);
  if(v){ showFav(v); if(!nameTouched){ const g=guessName(v); if(g) nameIn.value=g; } }
  else { favBar.classList.remove('on'); }
  update();
}

urlIn.addEventListener('input', onUrlChange);
urlIn.addEventListener('blur', ()=>{
  let v=urlIn.value.trim();
  // auto-prepend https:// if missing
  if(v && !v.startsWith('http')){ v='https://'+v; urlIn.value=v; }
  onUrlChange();
});

nameIn.addEventListener('input',()=>{ nameTouched=true; update(); });
nameIn.addEventListener('focus',()=>{ if(!nameTouched&&!nameIn.value&&urlIn.value){ nameIn.value=guessName(urlIn.value); } });

catIn.addEventListener('change',()=>{ catWrap.classList.toggle('on', catIn.value==='__new__'); update(); });
catKey.addEventListener('input', update);
catLabel.addEventListener('input', update);
dateToggle.addEventListener('change',()=>{ dateRow.classList.toggle('on', dateToggle.checked); update(); });
dateIn.addEventListener('input', update);

/* ‚îÄ‚îÄ Main update ‚îÄ‚îÄ */
function update(){
  const n=nameIn.value.trim(), u=urlIn.value.trim(), c=getCat();
  const d=dateToggle.checked?dateIn.value:'';
  const valid=!!(n&&u);
  addQBtn.disabled=!valid; cpDirectBtn.disabled=!valid;

  if(!n&&!u){ outTxt.innerHTML='<span class="ph">Fill in the fields above‚Ä¶ output appears here.</span>'; catOutWrap.style.display='none'; return; }
  outTxt.innerHTML=hl(n||'‚Ä¶',u||'‚Ä¶',c,d);

  if(catIn.value==='__new__'&&catKey.value.trim()){
    const k=catKey.value.trim().replace(/\s+/g,'').toLowerCase();
    const l=catLabel.value.trim()||k;
    catOutTxt.innerHTML=hlCat(k,l);
    catOutWrap.style.display='block';
  } else catOutWrap.style.display='none';
}

/* ‚îÄ‚îÄ Copy ‚îÄ‚îÄ */
function doCopy(text, btn, block){
  const fallback=()=>{ const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;opacity:0';document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta); };
  (navigator.clipboard?navigator.clipboard.writeText(text).catch(fallback):Promise.resolve(fallback())).finally(()=>{
    if(btn){ btn.classList.add('copied'); setTimeout(()=>btn.classList.remove('copied'),1800); }
    if(block){ block.classList.add('flash'); setTimeout(()=>block.classList.remove('flash'),500); }
    toast('Copied ‚úì');
  });
}

cpBtn.addEventListener('click',()=>{ const n=nameIn.value.trim()||'‚Ä¶',u=urlIn.value.trim()||'‚Ä¶',c=getCat(),d=dateToggle.checked?dateIn.value:''; doCopy(buildLine(n,u,c,d),cpBtn,outBlock); });
cpDirectBtn.addEventListener('click',()=>{ const n=nameIn.value.trim(),u=urlIn.value.trim(),c=getCat(),d=dateToggle.checked?dateIn.value:''; if(!n||!u){toast('Fill in URL and name first','err');return;} doCopy(buildLine(n,u,c,d),null,outBlock); });
cpCatBtn.addEventListener('click',()=>{ const k=catKey.value.trim().replace(/\s+/g,'').toLowerCase(),l=catLabel.value.trim()||k; doCopy(buildCatLine(k,l),cpCatBtn,catOutBlock); });

/* ‚îÄ‚îÄ Reset form ‚îÄ‚îÄ */
function resetForm(){
  urlIn.value=''; nameIn.value=''; nameTouched=false;
  urlIn.classList.remove('ok','bad'); favBar.classList.remove('on');
  dateToggle.checked=false; dateRow.classList.remove('on');
  catIn.value='hub'; catWrap.classList.remove('on');
  update(); urlIn.focus();
}
resetBtn.addEventListener('click', resetForm);

/* ‚îÄ‚îÄ Queue rendering ‚îÄ‚îÄ */
function renderQ(){
  const has=queue.length>0;
  qWrap.classList.toggle('on', has);
  qEmpty.style.display=has?'none':'block';
  qBadge.style.display=has?'':'none';
  qBadge.textContent=queue.length;
  qCount.textContent=`${queue.length} item${queue.length!==1?'s':''}`;
  qItems.innerHTML='';
  queue.forEach((item,i)=>{
    const div=document.createElement('div'); div.className='q-item';
    div.innerHTML=hl(item.n,item.u,item.c,item.d||'');
    const rm=document.createElement('button'); rm.className='q-rm'; rm.title='Remove'; rm.textContent='√ó';
    rm.addEventListener('click',()=>{ queue.splice(i,1); renderQ(); toast('Removed'); });
    div.appendChild(rm); qItems.appendChild(div);
  });
}

/* ‚îÄ‚îÄ Add to queue ‚îÄ‚îÄ */
function addToQueue(){
  const n=nameIn.value.trim(),u=urlIn.value.trim(),c=getCat(),d=dateToggle.checked?dateIn.value:'';
  if(!n||!u){ toast('URL and name are required','err'); urlIn.focus(); return false; }
  queue.push({n,u,c,d}); renderQ();
  toast(`"${n}" added ¬∑ ${queue.length} in queue`,'info');
  resetForm(); return true;
}

addQBtn.addEventListener('click', addToQueue);
cpAllBtn.addEventListener('click',()=>{
  if(!queue.length){toast('Queue is empty','err');return;}
  doCopy(queue.map(i=>buildLine(i.n,i.u,i.c,i.d||'')).join('\n'),null,null);
  cpAllBtn.textContent='Copied ‚úì'; setTimeout(()=>cpAllBtn.textContent='Copy all',1800);
});
clrBtn.addEventListener('click',()=>{ if(!queue.length)return; if(confirm(`Clear all ${queue.length} item${queue.length!==1?'s':''}?`)){ queue=[]; renderQ(); toast('Queue cleared'); } });

/* ‚îÄ‚îÄ Bulk modal ‚îÄ‚îÄ */
function openBulk(){ bulkBg.classList.add('on'); bulkTA.value=''; bulkStat.textContent=''; bulkTA.focus(); }
function closeBulk(){ bulkBg.classList.remove('on'); }
bulkBtn.addEventListener('click', openBulk);
bulkBtnE.addEventListener('click', openBulk);
bulkCancel.addEventListener('click', closeBulk);
bulkBg.addEventListener('click',e=>{ if(e.target===bulkBg) closeBulk(); });

bulkTA.addEventListener('input',()=>{
  const lines=bulkTA.value.split('\n').map(l=>l.trim()).filter(l=>{ try{new URL(l);return true;}catch{return false;} });
  bulkStat.textContent=lines.length?`${lines.length} valid URL${lines.length!==1?'s':''} detected`:'';
});

bulkAdd.addEventListener('click',()=>{
  const cat=getCat();
  const lines=bulkTA.value.split('\n').map(l=>l.trim()).filter(l=>{ try{new URL(l);return true;}catch{return false;} });
  if(!lines.length){ toast('No valid URLs found','err'); return; }
  lines.forEach(u=>queue.push({n:guessName(u),u,c:cat,d:''}));
  renderQ(); closeBulk();
  toast(`${lines.length} URL${lines.length!==1?'s':''} added to queue`,'info');
});

/* ‚îÄ‚îÄ Keyboard shortcuts ‚îÄ‚îÄ */
document.addEventListener('keydown',e=>{
  // Enter ‚Üí add to queue (when url+name filled and no modal)
  if(e.key==='Enter' && !bulkBg.classList.contains('on') && document.activeElement!==bulkTA){
    if((document.activeElement===urlIn||document.activeElement===nameIn) && urlIn.value.trim() && nameIn.value.trim()){
      e.preventDefault(); addToQueue();
    }
  }
  // Escape ‚Üí close modal or reset form
  if(e.key==='Escape'){
    if(bulkBg.classList.contains('on')){ closeBulk(); return; }
    if(urlIn.value||nameIn.value){ resetForm(); toast('Form cleared','info'); }
  }
});

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
update(); renderQ(); urlIn.focus();
</script>
</body>
</html>
